<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kho Linh Kiện Điện Tử - Trang Chủ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        .image-zoom { transition: transform 0.3s ease; }
        .image-zoom:hover { transform: scale(1.05); }
        .skeleton { @apply bg-gray-200 animate-pulse rounded; }
        .badge { @apply px-3 py-1 rounded-full text-xs font-medium; }
        .slide { transition: opacity 0.8s ease-in-out; }
        .slide.active { opacity: 1; }
        .slide { opacity: 0; position: absolute; }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <!-- Navbar -->
    <nav class="bg-gradient-to-r from-blue-900 to-orange-500 py-4 shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center px-4">
            <a href="index.html" class="text-white text-2xl font-bold hover:text-yellow-300 transition">Kho Linh Kiện</a>
            
            <!-- Desktop Menu -->
            <ul class="hidden md:flex space-x-8">
                <li><a href="index.html" class="text-white hover:text-yellow-300 transition font-medium">Trang Chủ</a></li>
                <li><a href="products.html" class="text-white hover:text-yellow-300 transition font-medium">Sản Phẩm</a></li>
                <li><a href="rfq.html" class="text-white hover:text-yellow-300 transition font-medium">Yêu Cầu Báo Giá</a></li>
            </ul>

            <!-- Right Actions -->
            <div class="flex items-center space-x-4">
                <a href="cart.html" class="bg-white text-orange-500 px-4 py-2 rounded-full flex items-center gap-2 shadow hover:shadow-md transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                    <span id="cartCount" class="bg-blue-900 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                </a>
                <div id="loginIcon" class="bg-white text-blue-900 px-4 py-2 rounded-full cursor-pointer shadow hover:shadow-md transition font-medium" onclick="openLogin()">Đăng Nhập</div>
                
                <!-- Mobile Menu Button -->
                <button id="mobileMenuBtn" class="md:hidden text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                </button>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobileMenu" class="md:hidden hidden bg-blue-800 text-white py-4">
            <a href="index.html" class="block px-6 py-2 hover:bg-blue-700">Trang Chủ</a>
            <a href="products.html" class="block px-6 py-2 hover:bg-blue-700">Sản Phẩm</a>
            <a href="rfq.html" class="block px-6 py-2 hover:bg-blue-700">Yêu Cầu Báo Giá</a>
        </div>
    </nav>

    <!-- Hero Slider -->
    <section class="relative h-96 md:h-screen max-h-screen overflow-hidden">
        <div id="slider" class="absolute inset-0">
            <div class="slide active w-full h-full bg-cover bg-center" style="background-image: url('images/image.png');"></div>
            <div class="slide w-full h-full bg-cover bg-center" style="background-image: url('images/img2.jpg');"></div>
            <div class="slide w-full h-full bg-cover bg-center" style="background-image: url('images/img3.jpg');"></div>
        </div>

        <!-- Overlay -->
        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>

        <!-- Content -->
        <div class="absolute bottom-0 left-0 right-0 text-white p-8 md:p-16 max-w-7xl mx-auto">
            <h1 class="text-4xl md:text-6xl font-bold mb-4 slide-up">Chào Mừng Đến Với Kho Linh Kiện</h1>
            <p class="text-lg md:text-xl mb-8 max-w-2xl slide-up delay-1">Cung cấp linh kiện điện tử chất lượng cao, giá tốt nhất thị trường</p>
            <a href="products.html" class="inline-block bg-orange-500 text-white px-8 py-4 rounded-xl text-lg font-semibold hover:bg-orange-600 transition shadow-lg hover:shadow-xl slide-up delay-2">
                Khám Phá Ngay
            </a>
        </div>

        <!-- Slider Controls -->
        <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 flex space-x-3">
            <button class="w-3 h-3 rounded-full bg-white/50 hover:bg-white transition" onclick="currentSlide(0)"></button>
            <button class="w-3 h-3 rounded-full bg-white/50 hover:bg-white transition" onclick="currentSlide(1)"></button>
            <button class="w-3 h-3 rounded-full bg-white/50 hover:bg-white transition" onclick="currentSlide(2)"></button>
        </div>
    </section>

    <!-- Featured Products -->
    <section class="max-w-7xl mx-auto px-4 py-16">
        <div class="text-center mb-12">
            <h2 class="text-4xl font-bold text-blue-900 mb-4 slide-up">Linh Kiện Nổi Bật</h2>
            <p class="text-gray-600 slide-up delay-1">Sản phẩm được ưa chuộng nhất trong tháng</p>
        </div>

        <!-- Skeleton Loading -->
        <div id="featuredProducts" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Will be filled by JS -->
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-blue-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-8">
            <div>
                <h3 class="text-xl font-bold mb-4">Kho Linh Kiện Điện Tử</h3>
                <p class="text-blue-200">Nhà cung cấp linh kiện điện tử uy tín hàng đầu Việt Nam</p>
            </div>
            <div>
                <h3 class="text-xl font-bold mb-4">Liên Hệ</h3>
                <p class="text-blue-200">Email: contact@kholinhkien.vn</p>
                <p class="text-blue-200">Hotline: 1900 1234</p>
                <p class="text-blue-200">Địa chỉ: 123 Điện Biên Phủ, Q.3, TP.HCM</p>
            </div>
            <div>
                <h3 class="text-xl font-bold mb-4">Theo Dõi Chúng Tôi</h3>
                <div class="flex space-x-4">
                    <a href="#" class="w-10 h-10 bg-blue-700 rounded-full flex items-center justify-center hover:bg-blue-600 transition">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.69a4.28 4.28 0 001.88-2.37 8.59 8.59 0 01-2.72 1.04 4.27 4.27 0 00-7.28 3.9A12.12 12.12 0 013.13 4.8a4.27 4.27 0 001.32 5.7 4.24 4.24 0 01-1.93-.53v.05a4.27 4.27 0 003.43 4.18 4.28 4.28 0 01-1.93.07 4.27 4.27 0 003.98 2.96A8.56 8.56 0 012 19.54a12.08 12.08 0 006.54 1.92c7.85 0 12.15-6.5 12.15-12.14 0-.19 0-.37-.01-.55A8.7 8.7 0 0024 5.9a8.5 8.5 0 01-2.54.7z"/></svg>
                    </a>
                    <a href="#" class="w-10 h-10 bg-blue-700 rounded-full flex items-center justify-center hover:bg-blue-600 transition">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.04c-5.5 0-9.96 4.46-9.96 9.96 0 4.41 2.86 8.15 6.84 9.49.5.09.68-.22.68-.48 0-.24-.01-.87-.01-1.71-2.78.6-3.37-1.34-3.37-1.34-.45-1.15-1.11-1.46-1.11-1.46-.91-.62.07-.61.07-.61 1 .07 1.53 1.03 1.53 1.03.89 1.52 2.34 1.08 2.91.83.09-.65.35-1.08.63-1.33-2.22-.25-4.56-1.11-4.56-4.95 0-1.09.39-1.99 1.03-2.69-.1-.25-.45-1.27.1-2.65 0 0 .84-.27 2.75 1.02a9.56 9.56 0 012.5-.34c.85 0 1.7.11 2.5.34 1.91-1.29 2.75-1.02 2.75-1.02.55 1.38.2 2.4.1 2.65.64.7 1.03 1.6 1.03 2.69 0 3.85-2.34 4.7-4.57 4.95.36.31.68 1.01.68 2.03 0 1.47-.01 2.65-.01 3.01 0 .26.18.57.69.48a9.96 9.96 0 006.84-9.49c0-5.5-4.46-9.96-9.96-9.96z"/></svg>
                    </a>
                </div>
            </div>
        </div>
        <div class="text-center mt-8 pt-8 border-t border-blue-800 text-blue-300 text-sm">
            <p>© 2025 Kho Linh Kiện Điện Tử. All rights reserved.</p>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden z-50">
        <div class="bg-white p-8 rounded-2xl w-full max-w-md shadow-2xl">
            <h2 id="modalTitle" class="text-2xl font-bold mb-6 text-center text-blue-900">Đăng Nhập</h2>
            <form id="authForm" class="space-y-4">
                <input type="email" name="email" placeholder="Email" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-900" required>
                <input type="password" name="password" placeholder="Mật khẩu" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-900" required>
                <input id="companyNameInput" type="text" name="companyName" placeholder="Tên công ty" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-900 hidden">
                <button type="submit" id="submitButton" class="w-full py-3 bg-blue-900 text-white rounded-lg hover:bg-orange-500 transition">Đăng Nhập</button>
            </form>
            <button id="toggleAuth" class="w-full text-blue-900 mt-4 hover:text-orange-500 text-center">Chưa có tài khoản? Đăng ký</button>
            <button class="w-full py-2 bg-gray-500 text-white rounded-lg mt-4 hover:bg-gray-600 transition" onclick="closeLogin()">Đóng</button>
        </div>
    </div>

    <script>
        let currentUser = null;
        let slideIndex = 0;

        // Mobile Menu Toggle
        document.getElementById('mobileMenuBtn').onclick = () => {
            document.getElementById('mobileMenu').classList.toggle('hidden');
        };

        // Check session
        fetch('php/check_session.php')
            .then(r => r.ok ? r.json() : Promise.reject())
            .then(d => {
                if (d.loggedIn) {
                    currentUser = d.user;
                    const icon = document.getElementById('loginIcon');
                    icon.textContent = 'Cổng KH';
                    icon.onclick = () => location.href = 'portal.html';
                } else {
                    document.getElementById('loginIcon').onclick = openLogin;
                }
                updateRealTimeData();
                fetchFeaturedProducts();
                initSlider();
            })
            .catch(() => { fetchFeaturedProducts(); initSlider(); });

        // Slider
        function initSlider() {
            const slides = document.querySelectorAll('#slider .slide');
            slides[0].classList.add('active');
            setInterval(() => {
                slides[slideIndex].classList.remove('active');
                slideIndex = (slideIndex + 1) % slides.length;
                slides[slideIndex].classList.add('active');
            }, 5000);
        }
        function currentSlide(n) {
            const slides = document.querySelectorAll('#slider .slide');
            slides[slideIndex].classList.remove('active');
            slideIndex = n;
            slides[slideIndex].classList.add('active');
        }

        // Featured Products
        function fetchFeaturedProducts() {
            const container = document.getElementById('featuredProducts');
            container.innerHTML = `
                <div class="col-span-full grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                    ${[1,2,3].map(() => `
                        <div class="bg-white rounded-xl shadow-md overflow-hidden">
                            <div class="skeleton h-48"></div>
                            <div class="p-6 space-y-3">
                                <div class="skeleton h-6 w-3/4 rounded"></div>
                                <div class="skeleton h-5 w-1/2 rounded"></div>
                                <div class="skeleton h-4 w-full rounded"></div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            fetch('php/get_product_list.php')
                .then(r => r.ok ? r.json() : [])
                .then(products => {
                    container.innerHTML = products.slice(0, 3).map(p => {
                        const images = {1:'images/resistor.jpg',2:'images/capacitor.jpg',3:'images/transistor.jpg',4:'images/ic_chip.jpg'};
                        const img = images[p.id] || p.image || 'https://via.placeholder.com/300x200';
                        return `
                            <div class="bg-white rounded-xl shadow-md hover:shadow-2xl transition-all duration-300 overflow-hidden cursor-pointer group"
                                 onclick="location.href='product-detail.html?id=${p.id}'">
                                <div class="relative overflow-hidden">
                                    <img src="${img}" alt="${p.name}" class="w-full h-56 object-cover image-zoom">
                                    <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition"></div>
                                </div>
                                <div class="p-6">
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">${p.name}</h3>
                                    <p class="text-2xl font-bold text-blue-900 mb-3">$${parseFloat(p.price).toFixed(2)}</p>
                                    <p id="stock_${p.id}" class="text-sm mb-4"></p>
                                    <div class="bg-gradient-to-r from-blue-900 to-orange-500 text-white text-center py-3 rounded-lg font-medium hover:shadow-lg transition">
                                        Xem Chi Tiết
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    updateStockStatus(products.slice(0, 3));
                })
                .catch(() => {
                    container.innerHTML = '<p class="col-span-full text-red-600 text-center py-8">Lỗi tải sản phẩm!</p>';
                });
        }

        function updateStockStatus(products) {
            fetch('php/get_stock.php')
                .then(r => r.ok ? r.json() : [])
                .then(data => {
                    products.forEach(p => {
                        const el = document.getElementById(`stock_${p.id}`);
                        if (!el) return;
                        const stock = data.find(s => s.id == p.id)?.stock ?? p.stock;
                        const status = stock <= 0 ? 'Hết hàng' : stock <= 5 ? 'Sắp hết' : 'Còn hàng';
                        const color = stock <= 0 ? 'bg-red-100 text-red-800' : stock <= 5 ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800';
                        el.innerHTML = `<span class="badge ${color}">${status} • ${stock} sản phẩm</span>`;
                    });
                });
        }

        function updateRealTimeData() {
            fetch('php/cart_get.php')
                .then(r => r.ok ? r.json() : [])
                .then(cart => {
                    const total = cart.reduce((s, i) => s + parseInt(i.quantity), 0);
                    document.getElementById('cartCount').textContent = total;
                });
        }
        setInterval(updateRealTimeData, 5000);

        // Login Modal
        function openLogin() { document.getElementById('loginModal').classList.replace('hidden', 'flex'); }
        function closeLogin() { document.getElementById('loginModal').classList.replace('flex', 'hidden'); }

        document.getElementById('toggleAuth').onclick = () => {
            const isLogin = document.getElementById('modalTitle').textContent === 'Đăng Nhập';
            document.getElementById('modalTitle').textContent = isLogin ? 'Đăng Ký' : 'Đăng Nhập';
            document.getElementById('authForm').action = isLogin ? 'php/register.php' : 'php/login.php';
            document.getElementById('companyNameInput').classList.toggle('hidden', !isLogin);
            document.getElementById('submitButton').textContent = isLogin ? 'Đăng Ký' : 'Đăng Nhập';
            document.getElementById('toggleAuth').textContent = isLogin ? 'Đã có tài khoản? Đăng nhập' : 'Chưa có tài khoản? Đăng ký';
        };

        document.getElementById('authForm').onsubmit = e => {
            e.preventDefault();
            fetch(e.target.action, { method: 'POST', body: new FormData(e.target) })
                .then(r => r.json())
                .then(d => {
                    Toastify({ text: d.message, style: { background: d.success ? "#10b981" : "#ef4444" } }).showToast();
                    if (d.success) { closeLogin(); location.href = e.target.action.includes('login') ? 'portal.html' : 'rfq.html'; }
                });
        };

        // Animation
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                    if (entry.target.classList.contains('delay-1')) setTimeout(() => entry.target.classList.add('animate'), 100);
                    if (entry.target.classList.contains('delay-2')) setTimeout(() => entry.target.classList.add('animate'), 200);
                }
            });
        }, { threshold: 0.1 });
        document.querySelectorAll('.slide-up').forEach(el => observer.observe(el));
    </script>
</body>
</html>